# üöÄ –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –î–ï–ü–õ–û–Æ CLOUD FUNCTIONS

## üìã –ß–¢–û –°–û–ó–î–ê–ù–û

–í—Å–µ Cloud Functions –≥–æ—Ç–æ–≤—ã –≤ –ø–∞–ø–∫–µ `yandex-functions/`:

### ‚úÖ –£–∂–µ –∑–∞–¥–µ–ø–ª–æ–µ–Ω–Ω—ã–µ (7 —Ñ—É–Ω–∫—Ü–∏–π):
1. ‚úÖ `create-product` - —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
2. ‚úÖ `get-products` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤  
3. ‚úÖ `get-product-by-id` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –ø–æ ID
4. ‚úÖ `get-categories` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
5. ‚úÖ `get-cart` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã
6. ‚úÖ `save-cart` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã
7. ‚úÖ `create-order` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞

### üÜï –ù–£–ñ–ù–û –ó–ê–î–ï–ü–õ–û–ò–¢–¨ (17 –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π):

**–§–ê–ó–ê 1: Products & Categories (4 —Ñ—É–Ω–∫—Ü–∏–∏)**
- `update-product` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
- `delete-product` - —É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
- `create-category` - —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `delete-category` - —É–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

**–§–ê–ó–ê 2: Reviews (3 —Ñ—É–Ω–∫—Ü–∏–∏)**
- `get-reviews` - –ø–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–æ–≤
- `create-review` - —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–∑—ã–≤–∞
- `delete-review` - —É–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–∞

**–§–ê–ó–ê 3: Promo Codes (5 —Ñ—É–Ω–∫—Ü–∏–π)** ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û –¥–ª—è checkout!
- `validate-promo` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞
- `get-all-promos` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
- `create-promo` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞
- `update-promo` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞
- `delete-promo` - —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞

**–§–ê–ó–ê 4: Wishlist (2 —Ñ—É–Ω–∫—Ü–∏–∏)**
- `get-wishlist` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
- `update-wishlist` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ

**–§–ê–ó–ê 5: Stock Notifications (3 —Ñ—É–Ω–∫—Ü–∏–∏)**
- `get-stock-notifications` - –ø–æ–ª—É—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- `create-stock-notification` - —Å–æ–∑–¥–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `delete-stock-notification` - —É–¥–∞–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–§–ê–ó–ê 6: Push Subscriptions (3 —Ñ—É–Ω–∫—Ü–∏–∏)**
- `get-push-subscriptions` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫
- `save-push-subscription` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏
- `delete-push-subscription` - —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏

---

## üîß –°–ü–û–°–û–ë 1: –î–ï–ü–õ–û–ô –ß–ï–†–ï–ó YANDEX CLOUD CONSOLE (–†–µ–∫–æ–º–µ–Ω–¥—É—é)

### –®–∞–≥ 1: –û—Ç–∫—Ä—ã—Ç—å Cloud Functions
1. –ü–µ—Ä–µ–π—Ç–∏ –≤ https://console.cloud.yandex.ru
2. –í—ã–±—Ä–∞—Ç—å –≤–∞—à –∫–∞—Ç–∞–ª–æ–≥ (folder)
3. –û—Ç–∫—Ä—ã—Ç—å **Serverless ‚Üí Cloud Functions**

### –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é
–î–ª—è –ö–ê–ñ–î–û–ô –∏–∑ 17 —Ñ—É–Ω–∫—Ü–∏–π:

1. **–ù–∞–∂–∞—Ç—å "–°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é"**

2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ—É–Ω–∫—Ü–∏–∏:**
   - –ò–º—è: `update-product` (–∏–ª–∏ –¥—Ä—É–≥–æ–µ –∏–∑ —Å–ø–∏—Å–∫–∞)
   - –û–ø–∏—Å–∞–Ω–∏–µ: –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
   - –û–∫—Ä—É–∂–µ–Ω–∏–µ: `nodejs18`

3. **–ö–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏:**
   - –ú–µ—Ç–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è: **ZIP-–∞—Ä—Ö–∏–≤** –∏–ª–∏ **–†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞**
   - –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞: `index.handler`
   
   **–í–∞—Ä–∏–∞–Ω—Ç A - –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞:**
   - –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `yandex-functions/update-product/index.js`
   - –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `yandex-functions/update-product/package.json`
   
   **–í–∞—Ä–∏–∞–Ω—Ç B - ZIP-–∞—Ä—Ö–∏–≤:**
   - –ó–∞–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–∞–ø–∫—É `yandex-functions/update-product/`
   - –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞—Ä—Ö–∏–≤

4. **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
   - –¢–∞–π–º–∞—É—Ç: `10` —Å–µ–∫
   - –ü–∞–º—è—Ç—å: `128` –ú–ë
   - –°–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç: `aje47rf2630q59equess` (—Ç–æ—Ç –∂–µ —á—Ç–æ –∏ —É –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π)

5. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   ```
   YDB_ENDPOINT=<–≤–∞—à_endpoint>
   YDB_ACCESS_KEY_ID=<–≤–∞—à_–∫–ª—é—á>
   YDB_SECRET_KEY=<–≤–∞—à_—Å–µ–∫—Ä–µ—Ç>
   ```
   
   > ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ –∂–µ –∑–Ω–∞—á–µ–Ω–∏—è, —á—Ç–æ –∏ —É —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π!

6. **–ù–∞–∂–∞—Ç—å "–°–æ–∑–¥–∞—Ç—å –≤–µ—Ä—Å–∏—é"**

7. **–í–ê–ñ–ù–û! –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å Function ID:**
   - –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ñ—É–Ω–∫—Ü–∏–∏
   - –ù–∞–π—Ç–∏ **Function ID** (–Ω–∞–ø—Ä–∏–º–µ—Ä: `d4e4idepedeld78laqoc`)
   - –ó–∞–ø–∏—Å–∞—Ç—å –µ–≥–æ - –æ–Ω –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è API Gateway!

### –®–∞–≥ 3: –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –¥–ª—è –≤—Å–µ—Ö 17 —Ñ—É–Ω–∫—Ü–∏–π

–°–æ–∑–¥–∞—Ç—å –ø–æ –æ—á–µ—Ä–µ–¥–∏ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ —Å–ø–∏—Å–∫–∞ –≤—ã—à–µ.

---

## üìù –¢–ê–ë–õ–ò–¶–ê –î–õ–Ø –ó–ê–ü–ò–°–ò FUNCTION IDs

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç—É —Ç–∞–±–ª–∏—Ü—É:

| –§—É–Ω–∫—Ü–∏—è | Function ID |
|---------|-------------|
| update-product | `________________` |
| delete-product | `________________` |
| create-category | `________________` |
| delete-category | `________________` |
| get-reviews | `________________` |
| create-review | `________________` |
| delete-review | `________________` |
| validate-promo | `________________` |
| get-all-promos | `________________` |
| create-promo | `________________` |
| update-promo | `________________` |
| delete-promo | `________________` |
| get-wishlist | `________________` |
| update-wishlist | `________________` |
| get-stock-notifications | `________________` |
| create-stock-notification | `________________` |
| delete-stock-notification | `________________` |
| get-push-subscriptions | `________________` |
| save-push-subscription | `________________` |
| delete-push-subscription | `________________` |

---

## üåê –û–ë–ù–û–í–õ–ï–ù–ò–ï API GATEWAY

–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã –∏ —É –≤–∞—Å –µ—Å—Ç—å –≤—Å–µ Function IDs:

1. –û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª `API_GATEWAY_SPEC_FINAL.yaml` (–±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –∞–≥–µ–Ω—Ç–æ–º)
2. –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ `<FUNCTION_ID_...>` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ ID –∏–∑ —Ç–∞–±–ª–∏—Ü—ã –≤—ã—à–µ
3. –ü–µ—Ä–µ–π—Ç–∏ –≤ **Serverless ‚Üí API Gateway**
4. –í—ã–±—Ä–∞—Ç—å –≤–∞—à API Gateway
5. –ù–∞–∂–∞—Ç—å **"–ò–∑–º–µ–Ω–∏—Ç—å"**
6. –ó–∞–º–µ–Ω–∏—Ç—å –≤–µ—Å—å YAML –Ω–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏–∑ `API_GATEWAY_SPEC_FINAL.yaml`
7. –ù–∞–∂–∞—Ç—å **"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"**

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è API Gateway:

1. –û—Ç–∫—Ä—ã—Ç—å –≤–∞—à —Å–∞–π—Ç
2. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–π—Ç–∏ –≤ **–ê–¥–º–∏–Ω–∫—É**
3. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞—Ç—å —Ç–æ–≤–∞—Ä
4. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
5. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥ –ø—Ä–∏ checkout

–ï—Å–ª–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç - –º–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ! üéâ

---

## üÜò TROUBLESHOOTING

### –§—É–Ω–∫—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (YDB_ENDPOINT, YDB_ACCESS_KEY_ID, YDB_SECRET_KEY)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ Cloud Functions Console

### API Gateway –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 404
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Function ID —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø—É—Ç—å –≤ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ç–µ–º, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥

### –û—à–∏–±–∫–∏ CORS
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ –µ—Å—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Access-Control-Allow-Origin: *`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤ API Gateway –µ—Å—Ç—å OPTIONS –º–µ—Ç–æ–¥—ã –¥–ª—è CORS preflight

---

## üîÑ –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ê: –î–ï–ü–õ–û–ô –ß–ï–†–ï–ó YC CLI

–ï—Å–ª–∏ —É –≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Yandex Cloud CLI:

```bash
# –î–ª—è –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
cd yandex-functions/update-product
yc serverless function version create \
  --function-name=update-product \
  --runtime=nodejs18 \
  --entrypoint=index.handler \
  --memory=128m \
  --execution-timeout=10s \
  --source-path=. \
  --environment YDB_ENDPOINT=<endpoint> \
  --environment YDB_ACCESS_KEY_ID=<key> \
  --environment YDB_SECRET_KEY=<secret> \
  --service-account-id=aje47rf2630q59equess
```

–ù–æ —á–µ—Ä–µ–∑ Console –±—É–¥–µ—Ç –ø—Ä–æ—â–µ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞!
