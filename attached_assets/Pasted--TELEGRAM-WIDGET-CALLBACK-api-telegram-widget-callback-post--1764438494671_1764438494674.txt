# ========== TELEGRAM WIDGET CALLBACK ==========
  /api/telegram/widget-callback:
    post:
      summary: Callback от Telegram Login Widget
      operationId: telegramWidgetCallback
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
                - first_name
                - auth_date
                - hash
              properties:
                id:
                  type: integer
                first_name:
                  type: string
                last_name:
                  type: string
                username:
                  type: string
                photo_url:
                  type: string
                auth_date:
                  type: integer
                hash:
                  type: string
      x-yc-apigateway-integration:
        type: cloud_functions
        function_id: d4ea4vga6kcqndjl0mut
        service_account_id: aje47rf2630q59equess
      responses:
        '200':
          description: OK
        '401':
          description: Invalid signature
        '500':
          description: Server error
    options:
      summary: CORS preflight
      x-yc-apigateway-integration:
        type: dummy
        http_code: 200
        http_headers:
          'Access-Control-Allow-Origin': '*'
          'Access-Control-Allow-Methods': 'POST, OPTIONS'
          'Access-Control-Allow-Headers': 'Content-Type'
        content:
          application/json: '{}'
      responses:
        '200':
          description: OK
            # Привязка Email к Telegram аккаунту
  /api/users/attach-email:
    post:
      summary: Привязать Email и пароль к Telegram аккаунту
      description: Позволяет пользователю, зарегистрированному через Telegram, добавить Email и пароль к своему аккаунту
      operationId: attachEmail
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
                - email
                - password
                - passwordConfirm
              properties:
                token:
                  type: string
                  description: JWT токен пользователя
                  example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                email:
                  type: string
                  format: email
                  description: Email который хочет привязать пользователь
                  example: "user@example.com"
                password:
                  type: string
                  description: Новый пароль (минимум 6 символов)
                  example: "securePassword123"
                passwordConfirm:
                  type: string
                  description: Подтверждение пароля
                  example: "securePassword123"
      x-yc-apigateway-integration:
        type: cloud_functions
        function_id: d4eadnh9nmf7ni9359bq
        service_account_id: aje47rf2630q59equess
      responses:
        '200':
          description: Email успешно привязан
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  token:
                    type: string
                    description: Новый JWT токен с обновленными данными
                  user:
                    type: object
                    properties:
                      userId:
                        type: string
                      email:
                        type: string
                      telegramId:
                        type: string
        '400':
          description: Ошибка валидации (пароли не совпадают, email занят и т.д.)
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '401':
          description: Неверный или истекший токен
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '500':
          description: Ошибка сервера
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    # Привязать Telegram к email аккаунту
  /api/users/attach-telegram:
    post:
      summary: Привязать Telegram к email аккаунту
      description: Позволяет пользователю, зарегистрированному через email, добавить Telegram к своему аккаунту
      operationId: attachTelegram
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
                - initData
              properties:
                token:
                  type: string
                  description: JWT токен пользователя
                  example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                initData:
                  type: string
                  description: Данные от Telegram Web App (window.Telegram.WebApp.initData)
                  example: "query_id=AAHdF6IQAAAAO0Xng..."
      x-yc-apigateway-integration:
        type: cloud_functions
        function_id: d4eradehki5bndp1ehhc
        service_account_id: aje47rf2630q59equess
      responses:
        '200':
          description: Telegram успешно привязан
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  token:
                    type: string
                    description: Новый JWT токен с обновленными данными
                  user:
                    type: object
                    properties:
                      userId:
                        type: string
                      email:
                        type: string
                      telegramId:
                        type: string
        '400':
          description: Ошибка валидации (Telegram уже привязан к другому аккаунту и т.д.)
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '401':
          description: Неверный или истекший токен
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '500':
          description: Ошибка сервера
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string