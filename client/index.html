<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sweet Delights - –ú–∞–≥–∞–∑–∏–Ω —Å–ª–∞–¥–æ—Å—Ç–µ–π –∏ –∞–∫—Å–µ—Å—Å—É–∞—Ä–æ–≤</title>
    <meta name="description" content="–û—Ç–∫—Ä–æ–π—Ç–µ –¥–ª—è —Å–µ–±—è —à–∏—Ä–æ–∫–∏–π –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç —Å–ª–∞–¥–æ—Å—Ç–µ–π, —à–æ–∫–æ–ª–∞–¥–∞, –∫–æ–Ω—Ñ–µ—Ç –∏ —Å—Ç–∏–ª—å–Ω—ã—Ö –∞–∫—Å–µ—Å—Å—É–∞—Ä–æ–≤. –î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏. –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –ø—Ä–∏–º–µ—Ä–∫–∞." />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Luckiest+Guy&family=Bangers&family=Permanent+Marker&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">

    <!-- OneSignal Push Notifications -->
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
    <script>
      window.OneSignalDeferred = window.OneSignalDeferred || [];

      // –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ñ–ª–∞–≥ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ OneSignal
      window.OneSignalReady = false;

      OneSignalDeferred.push(async function(OneSignal) {
        console.log('üîî OneSignal: –ù–∞—á–∞–ª–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏');
        console.log('üîç OneSignal SDK –∑–∞–≥—Ä—É–∂–µ–Ω:', typeof OneSignal);

        try {
          console.log('‚öôÔ∏è –í—ã–∑—ã–≤–∞–µ–º OneSignal.init...');
          await OneSignal.init({
            appId: "db150a33-35e8-4669-94eb-27f4be9b07b2",
            safari_web_id: "web.onesignal.auto.db150a33-35e8-4669-94eb-27f4be9b07b2",
            notifyButton: {
              enable: false,
            },
            allowLocalhostAsSecureOrigin: true,
            serviceWorkerParam: { scope: '/' },
            serviceWorkerPath: 'OneSignalSDKWorker.js',
            promptOptions: {
              slidedown: {
                prompts: [
                  {
                    type: "push",
                    autoPrompt: false,
                    text: {
                      actionMessage: "–ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –æ–± –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–∞–≥–∞–∑–∏–Ω–∞!",
                      acceptButton: "–†–∞–∑—Ä–µ—à–∏—Ç—å",
                      cancelButton: "–ù–µ —Å–µ–π—á–∞—Å"
                    }
                  }
                ]
              }
            }
          });

          console.log('‚úÖ OneSignal.init() –∑–∞–≤–µ—Ä—à–µ–Ω');

          // –ñ–¥–µ–º –ø–æ–ª–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ User API
          let attempts = 0;
          while (!OneSignal.User && attempts < 50) {
            console.log('‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ User API... –ø–æ–ø—ã—Ç–∫–∞', attempts + 1);
            await new Promise(resolve => setTimeout(resolve, 100));
            attempts++;
          }

          if (!OneSignal.User) {
            throw new Error('OneSignal.User –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –ø–æ—Å–ª–µ –æ–∂–∏–¥–∞–Ω–∏—è');
          }

          console.log('‚úÖ OneSignal.User –¥–æ—Å—Ç—É–ø–µ–Ω');

          // –ñ–¥–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ PushSubscription
          attempts = 0;
          while (!OneSignal.User.PushSubscription && attempts < 50) {
            console.log('‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ PushSubscription... –ø–æ–ø—ã—Ç–∫–∞', attempts + 1);
            await new Promise(resolve => setTimeout(resolve, 100));
            attempts++;
          }

          if (!OneSignal.User.PushSubscription) {
            throw new Error('OneSignal.User.PushSubscription –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
          }

          console.log('‚úÖ OneSignal.User.PushSubscription –¥–æ—Å—Ç—É–ø–µ–Ω');

          // –ü—Ä–æ–≤–µ—Ä—è–µ–º Slidedown API
          if (!OneSignal.Slidedown) {
            throw new Error('OneSignal.Slidedown –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
          }

          console.log('‚úÖ OneSignal.Slidedown –¥–æ—Å—Ç—É–ø–µ–Ω');

          // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
          window.OneSignalReady = true;
          console.log('üéâ OneSignal –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!');

          // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏
          try {
            const isSubscribed = await OneSignal.User.PushSubscription.optedIn;
            const permission = OneSignal.Notifications ? await OneSignal.Notifications.permission : 'unknown';
            const token = OneSignal.User.PushSubscription.token;

            console.log('üìä OneSignal —Å—Ç–∞—Ç—É—Å:', {
              isSubscribed: isSubscribed,
              permission: permission,
              pushToken: token,
              userId: OneSignal.User.PushSubscription.id
            });
          } catch (statusError) {
            console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏:', statusError);
          }

          // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é Service Worker
          if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(registrations => {
              console.log('üîß Service Workers –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ:', registrations.length);
              registrations.forEach((reg, i) => {
                console.log(`  ${i + 1}. Scope: ${reg.scope}, Active: ${!!reg.active}`);
              });
            });
          }

        } catch (error) {
          console.error('‚ùå OneSignal: –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
          console.error('‚ùå –¢–∏–ø –æ—à–∏–±–∫–∏:', typeof error);
          if (error && typeof error === 'object') {
            if ('message' in error) {
              console.error('‚ùå –°–æ–æ–±—â–µ–Ω–∏–µ:', error.message);
            }
            if ('stack' in error) {
              console.error('‚ùå Stack trace:', error.stack);
            }
          }
          // –ù–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ
          window.OneSignalReady = false;
          return;
        }
      });
    </script>

    <!-- Start Single Page Apps for GitHub Pages -->
    <script>
      // Single Page Apps for GitHub Pages
      // MIT License
      // https://github.com/rafgraph/spa-github-pages
      (function(l) {
        if (l.search[1] === '/' ) {
          var decoded = l.search.slice(1).split('&').map(function(s) { 
            return s.replace(/~and~/g, '&')
          }).join('?');
          var pathname = l.pathname;
          if (pathname.endsWith('/')) {
            pathname = pathname.slice(0, -1);
          }
          window.history.replaceState(null, null,
              pathname + decoded + l.hash
          );
        }
      }(window.location))
    </script>
    <!-- End Single Page Apps for GitHub Pages -->
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>