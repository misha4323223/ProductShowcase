<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="yandex-verification" content="6f7fc99e78232bb8" />
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
    
    <title>Sweet Delights - Купить сладости онлайн | Необычные подарки</title>
    <meta name="description" content="Купить сладости онлайн в Sweet Delights - необычные подарки и сладкие наслаждения! Мармелад, маршмелоу, моти, леденцы, шоколад, подарочные наборы. Заказать конфеты с доставкой по России." />
    <meta name="keywords" content="купить сладости онлайн, заказать конфеты с доставкой, необычные подарки, необычные сладости, мармелад, маршмелоу, моти, леденцы, шоколад, подарочные наборы, печенье, пирожные, сладкие подарки, подарки со вкусом, интересные подарки, сладкие наслаждения" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://sweetdelights.github.io/" />
    <meta property="og:title" content="Sweet Delights - Необычные сладости с доставкой по России" />
    <meta property="og:description" content="Мармелад, маршмелоу, моти, леденцы, шоколад и другие необычные сладости. Доставка по всей России. Подарочные наборы и эксклюзивные предложения!" />
    <meta property="og:image" content="https://sweetdelights.github.io/og-image.png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:locale" content="ru_RU" />
    <meta property="og:site_name" content="Sweet Delights" />
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Sweet Delights - Необычные сладости с доставкой" />
    <meta name="twitter:description" content="Мармелад, маршмелоу, моти, шоколад и другие необычные сладости с доставкой по России" />
    <meta name="twitter:image" content="https://sweetdelights.github.io/og-image.png" />
    
    <!-- DNS Prefetch & Preconnect для быстрой загрузки -->
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Preload критических ресурсов для первой отрисовки страницы -->
    <!-- Preload Google Fonts CSS для быстрой загрузки шрифтов -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Pacifico&family=Luckiest+Guy&family=Bangers&family=Permanent+Marker&family=Comic+Neue:wght@400;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Pacifico&family=Luckiest+Guy&family=Bangers&family=Permanent+Marker&family=Comic+Neue:wght@400;700&display=swap"></noscript>
    
    <!-- Hero-изображение preload-ится динамически через JavaScript на главной странице (Home.tsx) -->
    
    <!-- Fallback для браузеров без JS -->
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Luckiest+Guy&family=Bangers&family=Permanent+Marker&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">

    <!-- Telegram Login Widget -->
    <script async src="https://telegram.org/js/telegram-widget.js?22"></script>

    <!-- Schema.org разметка для Google и Яндекс -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Store",
      "name": "Sweet Delights",
      "description": "Необычные сладости с доставкой по России - мармелад, маршмелоу, моти, леденцы, шоколад, подарочные наборы",
      "url": "https://sweetdelights.github.io",
      "logo": "https://sweetdelights.github.io/android-chrome-512x512.png",
      "image": "https://sweetdelights.github.io/og-image.png",
      "priceRange": "100-2000₽",
      "currenciesAccepted": "RUB",
      "paymentAccepted": ["Карта", "СБП", "Наличные при получении"],
      "areaServed": "RU",
      "openingHours": "Mo-Su 00:00-23:59"
    }
    </script>
    
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Sweet Delights",
      "url": "https://sweetdelights.github.io",
      "logo": "https://sweetdelights.github.io/android-chrome-512x512.png",
      "description": "Интернет-магазин необычных сладостей с доставкой по России"
    }
    </script>

    <!-- Start Single Page Apps for GitHub Pages -->
    <script>
      // Single Page Apps for GitHub Pages
      // MIT License
      // https://github.com/rafgraph/spa-github-pages
      (function(l) {
        if (l.search[1] === '/' ) {
          var decoded = l.search.slice(1).split('&').map(function(s) { 
            return s.replace(/~and~/g, '&')
          }).join('?');
          var pathname = l.pathname;
          if (pathname.endsWith('/')) {
            pathname = pathname.slice(0, -1);
          }
          window.history.replaceState(null, null,
              pathname + decoded + l.hash
          );
        }
      }(window.location))
    </script>
    <!-- End Single Page Apps for GitHub Pages -->
    
    <!-- ОПТИМИЗАЦИЯ: Загрузка темы + фона БЕЗ мерцания перед React монтированием -->
    <script>
      (function() {
        const API_BASE_URL = 'https://d5dimdj7itkijbl4s0g4.y5sm01em.apigw.yandexcloud.net';
        
        // Promise который разрешится когда ВСЕ готово: тема + фон + класс на документе
        window.__themeReady = (async () => {
          try {
            // Загружаем текущую тему
            const themeRes = await fetch(`${API_BASE_URL}/site-settings?key=current_theme`, {
              method: 'GET',
              headers: { 'Content-Type': 'application/json' },
            });
            const themeData = await themeRes.json();
            const theme = themeData.settingValue || 'new-year';
            
            // Валидируем тему
            const validTheme = ['light', 'dark', 'sakura', 'new-year', 'spring', 'autumn'].includes(theme) 
              ? theme 
              : 'new-year';
            
            // Сохраняем для React контекста
            window.__initialTheme = validTheme;
            
            // Применяем класс темы к html ДО загрузки фона
            document.documentElement.classList.add(validTheme);
            
            // Загружаем фоны (background_settings)
            try {
              const bgRes = await fetch(`${API_BASE_URL}/site-settings?key=background_settings`, {
                method: 'GET',
                headers: { 'Content-Type': 'application/json' },
              });
              const bgData = await bgRes.json();
              const bgSettings = bgData.settingValue ? JSON.parse(bgData.settingValue) : null;
              
              if (bgSettings) {
                // Применяем фон для текущей темы
                const themeKey = validTheme === 'new-year' ? 'newyear' : validTheme;
                const themeBg = bgSettings[themeKey];
                
                if (themeBg && (themeBg.webpImage || themeBg.image)) {
                  const imageUrl = themeBg.webpImage || themeBg.image;
                  document.body.style.backgroundImage = `url('${imageUrl}')`;
                  document.body.style.backgroundAttachment = 'fixed';
                }
              }
            } catch (bgErr) {
              console.error('Failed to load backgrounds:', bgErr);
              // Продолжаем даже если фоны не загрузились
            }
          } catch (err) {
            console.error('Failed to load theme:', err);
            document.documentElement.classList.add('new-year');
            window.__initialTheme = 'new-year';
          }
        })();
      })();
    </script>
  </head>
  <body>
    <!-- Robokassa iFrame SDK для СБП QR-кода -->
    <script async src="https://auth.robokassa.ru/Merchant/bundle/robokassa_iframe.js"></script>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
